{% extends 'base.html' %}

{% block pagebody %}

<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
.collapsible {
  background-color: rgb(13, 202, 240);
  color: white;
  cursor: pointer;
  padding: 18px;
  width: 100%;
  border: none;
  text-align: left;
  outline: none;
  font-size: 15px;
}

.active, .collapsible:hover {
  background-color: rgb(13, 202, 240);
}

.content {
  padding: 0 18px;
  display: none;
  overflow: hidden;
  background-color: #f1f1f1;
}
</style>

<div style="background-image: url('static/prenotations.jpg'); width: 100%; height: 400px; background-size: cover; background-repeat: no-repeat; background-position: center center;"></div>
<div class="py-4 bg-info text-white text-center">
  <h1 class="display-3">Book a Shift</h1>
</div>
<div class="container py-4">
  <div>
    <form action="{{url_for('shifts_load_state')}}" method="POST">
      <div class="row w-75 mx-auto mt-4">
        <div class="col text-center">
          <strong>Date</strong> 
          <input name="date" type="date", value= {{ date_string }} >
        </div>
        <div class="col text-center">
          <strong>Room</strong>
          <select id="room" name="room">
            <option value="All">All</option>
            {% for i in rooms %}
            <option value="{{ i.name }}"> {{ i.name }} </option>
            {% endfor %}
          </select>
        </div>
        <div class="col text-center">
          <input type="submit", value="Search" class="btn btn-info text-light" >
        </div>
      </div>
    </form>
  </div>

  {% if get_flashed_messages(category_filter=('error')) %}
  <div class="card bg-light shadow" style="width: 30rem; height: 32rem; margin: auto; margin-top: 8%; border: hidden;">
  {% else %}
    <div class="card bg-light shadow" style="width: 30rem; height: 28rem; margin: auto; margin-top: 8%; border: hidden;">
  {% endif %}

{% if get_flashed_messages(category_filter=('error')) %}
  <p class="alert alert-danger" role="alert"> {{ get_flashed_messages(category_filter=('error'))[0] }}
{% elif get_flashed_messages(category_filter=('success')) %}
  <p class="alert alert-success" role="alert"> {{ get_flashed_messages(category_filter=('success'))[0] }}
{% endif %}
  

  <div class=" w-75 mx-auto mt-4">
    <table class="table table-hover">
      <tr>
        <th>Date</th>
        <th>Start</th>
        <th>End</th>
        <th>Room</th>
        <th>Capacity</th>
        <th>Booking</th>
      </tr>

      {% for s in shifts %}
      <tr>
        <td>{{ s[0] }}</td>
        <td>{{ s[1] }}</td>
        <td>{{ s[2] }}</td>
        <td>{{ s[3].name }}</td>
        <td>{{ s[4] }} / {{ s[3].max_capacity }}</td>
        <td>
          {% if current_user.is_authenticated and "Admin" in current_user.roles %}
            <button type="button" class="collapsible">Users</button>
            <div class="content">
              {% for u in s.users_prenoted %}
                {{u.fullname}} <br>
              {% endfor %}
            </div>
          {% else %}
            {% if s[4] > 0 %}
              <form action= "{{ url_for('prenotation', shift = s.id) }}">
                <input type="submit", value="Book" class="btn btn-success btn-sm">
              </form>
            {% else %}
                <input type="submit", value="Full" class="btn btn-success btn-sm">
            {% endif %}
          {% endif %}
        </td>
      </tr>
      {% endfor %}
    </table>
  </div>
</div>
</div>
<div class="py-5 bg-info text-white text-center"></div>

<script>
  var coll = document.getElementsByClassName("collapsible");
  var i;
  
  for (i = 0; i < coll.length; i++) {
    coll[i].addEventListener("click", function() {
      this.classList.toggle("active");
      var content = this.nextElementSibling;
      if (content.style.display === "block") {
        content.style.display = "none";
      } else {
        content.style.display = "block";
      }
    });
  }
</script>

{% endblock %}
